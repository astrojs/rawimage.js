<html>
<head>
  <link rel="stylesheet" href="/examples/astrojs.css" type="text/css" charset="utf-8">
  
  <style>
  .fluid {
    width: 80%;
    height: 80%;
    border: 1px solid blue;
  }
  
  </style>
  <script type="text/javascript" src="/examples/lib/fits.js"></script>
  <script type="text/javascript" src="/rawimage.js"></script>
  <script type="text/javascript">
  
  // Define callback to be executed after FITS is received from the server
  function getImage(f, opts) {
    
    // Get first data unit
    var dataunit = f.getDataUnit();
    
    // Set options to pass to the next callback
    opts = {
      dataunit: dataunit,
      el: opts.el
    };
    
    // Get pixels representing the image and pass callback with options
    dataunit.getFrame(0, createVisualization, opts);
    
  }
  
  // Define callback for when pixels have been read from file
  function createVisualization(arr, opts) {
    
    // Get dataunit, width, and height from options
    var dataunit = opts.dataunit;
    var width = dataunit.width;
    var height = dataunit.height;
    
    // Get the minimum and maximum pixels
    var extent = dataunit.getExtent(arr);
    
    // Get the DOM element
    var el = document.querySelector('#' + opts.el);
    
    // Initialize a RawImage context with a viewer of size width
    
    // Get the width and height of the fluid element
    var fluidEl = document.querySelector(".fluid");
    var widthEl = fluidEl.clientWidth, heightEl = fluidEl.clientHeight;
    
    var raw = new RawImage(el, widthEl, heightEl);
    
    // Enable pan and zoom controls
    raw.setupControls();
    
    // Load array representation of image
    raw.loadImage('m101', arr, width, height);
    
    // Set the intensity range and stretch
    raw.setExtent(extent[0], extent[1]);
    // raw.setTransfer('linear');
    
    // // Optionally set colormap.  WebFITS defaults to grayscale mapping.
    // raw.setColorMap('binary');
    
    window.raw = raw;
    
    window.onresize = function(e) {
      raw.resize(fluidEl.clientWidth, fluidEl.clientHeight);
    }
    
  }
  
  function main() {
    
    // Define the path and options
    var path = '/examples/data/m101.fits'
    // var path = '/examples/data/hlsp_hudf12_hst_acs_udfpar2_f814w_v1.0_drz_drz.fits'
    // var path = '/examples/data/test-8400.fits'
    var opts = {el: 'wicked-science-visualization'};
    
    // Initialize a FITS file, passing getImage function as a callback
    var f = new astro.FITS(path, getImage, opts);
  }
  </script>
  
  
</head>

<body onload='main()'>
  <div class='content'>
    <h3>Single RawImage Instance (WebGL)</h3>
    <div class="fluid">
      <div id="wicked-science-visualization"></div>
    </div>
  </div>
</body>
</html>