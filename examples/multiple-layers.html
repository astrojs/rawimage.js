<html>
<head>
  <script type="text/javascript" src="lib/fits.js"></script>
  <script type="text/javascript" src="/lib/webfits-gl-0.0.1.js"></script>
  <script type="text/javascript">
  
  // Define callback to be executed after image is received from the server
  function getImage(f, opts) {
    
    // Get first data unit
    var dataunit = f.getDataUnit();
    opts.dataunit = dataunit
    
    // Asynchronously get pixels representing the image
    dataunit.getFrameAsync(0, createVisualization, opts);
  }
  
  // Define callback for when pixels have been read from file
  function createVisualization(arr, opts) {
    var dataunit = opts.dataunit;
    
    var width = dataunit.width;
    var height = dataunit.height;
    
    // Load the image
    var webfits = opts.webfits;
    webfits.loadImage(opts.identifier, arr, width, height);
    
    // Initialize the color shader when all three layers are imported
    if (Object.keys(webfits.lookup).length === 3) {
      webfits.setupColorShader('ir', 'red', 'blue');
      webfits.setScale('ir', 1.0);
      webfits.setScale('red', 1.0);
      webfits.setScale('blue', 1.0);
      webfits.setAlpha(0.03);
      webfits.setQ(1.0);
      webfits.drawColor();
      console.log('ready');
    }
  }
  
  function main() {
    
    // Define paths to files
    var path1 = '/examples/data/m101_red.fits';
    var path2 = '/examples/data/m101_blue.fits';
    var path3 = '/examples/data/m101_ir.fits';
    
    // Initialize WebFITS object
    var el = document.querySelector('#wicked-science-visualization');
    var webfits = new astro.WebFITS(el, 600);
    
    var f1 = new astro.FITS.File(path1, getImage, {identifier: 'red', webfits: webfits});
    var f2 = new astro.FITS.File(path2, getImage, {identifier: 'blue', webfits: webfits});
    var f3 = new astro.FITS.File(path3, getImage, {identifier: 'ir', webfits: webfits});
  }
  </script>
  
  
</head>

<body onload='main()'>
  <h3>examples of Astronomical Image Visualization</h3>
  <div id="wicked-science-visualization"></div>
</body>
</html>